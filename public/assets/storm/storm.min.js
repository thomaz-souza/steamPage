$.fn.storm=function(t){let o=this;return o.get=function(){o.tran("select",o.set)},o.set=function(e){if(200==e.status)return o._o.onData&&(newData=o._o.onData(e.data,o),newData&&(e.data=newData)),o._d=e.data,o.plot(),o;o._o.onError&&o._o.onError(e,o),console.error(e)},o.plot=function(){let e,t;for(e in o._d)if("array"!=typeof o._d[e]&&"object"!=typeof o._d[e]){if(o._e[e])if("checkbox"==(t=o._e[e]).type)t.element.value==o._d[e]?t.element.checked=!0:t.element.checked=!1;else if("radio"==t.type){let t=o[0].querySelectorAll("input[type=radio][name="+e+"]");for(k=0;k<t.length;k++)t[k].value==o._d[e]&&(t[k].checked=!0)}else"file"==t.type&&$(t.element).attr("data-picpuload-file")?$("[data-picpuload-pic="+$(t.element).attr("data-picpuload-file")+"]").css("background-image","url("+o._d[e]+")"):"file"==t.type||$(t.element).val(o._d[e])}else{if(!o._e[e+"[]"])continue;"checkbox"!=(t=o._e[e+"[]"]).type&&"radio"!=t.type||$(t.element).each(function(t,n){-1!=o._d[e].indexOf(n.value)?($(n).prop("checked",!0),$(n).prop("selected",!0)):($(n).prop("checked",!1),$(n).prop("selected",!1))}),$(t.element).val(o._d[e])}o.parseElements(),o._o.onSet&&o._o.onSet(!1),o._o.onLoading&&o._o.onLoading(!1)},o.getChanged=function(e){let t={};for(i in o._e)o.hasChanged(i)&&(t[i]=o._e[i]);return t},o.hasChanged=function(e){let t=o._e[e],n=o.getValue(t.element),a=typeof n;return"string"==a||"boolean"==a?t.value!=n:"array"==a||"object"==a?JSON.stringify(n)!=JSON.stringify(t.value):void 0},o.getValue=function(e){let t=$(e).prop("type"),n=$(e).prop("name");if("checkbox"==t&&-1!=n.indexOf("[]")){var a=[];return $('[name="'+n+'"]').each(function(e,t){t.checked&&a.push(t.value)}),a}if("checkbox"==t){let t=$(e).attr("data-value-unchecked");return e.checked?e.value:t||!1}return"radio"==t?(rd=o[0].querySelectorAll("input[type=radio][name="+n+"]:checked"),rd.length>0?rd[0].value:""):$(e).val()},o.parseElements=function(){let e=o[0].elements;for(i of(o._e=o._e?o._e:{},e)){$(i).removeClass("hasError"),$(i).on("input",o.watch),$(i).change(o.watch);let e=i;if(-1!=i.name.indexOf("[]")){if(o._e[i.name]){o._e[i.name].element.push(i);continue}e=[i]}let t=o.getValue(i);o._e[i.name]={type:$(i).prop("type"),element:e,value:t,default:o._e[i.name]?o._e[i.name].default:t}}o.watch()},o.toDefault=function(){let e,t={};for(let n in o._e)e=o._e[n],t[n=n.replace(/\[\]$/gi,"")]=e.default;o._o.keyValue=null,o._d=t,o.plot(),o._o.onReset&&o._o.onReset(o)},o.watch=function(){Object.keys(o.getChanged()).length>0?o._o.submitButton&&o._o.submitButton.prop("disabled",!1):o._o.submitButton&&o._o.submitButton.prop("disabled",!0)},o.submit=function(){o._o.submitButton&&o._o.submitButton.prop("disabled",!1),o._o.onLoading&&o._o.onLoading(!0);let e=request.parseForm(o[0]);"string"==typeof o._o.keyValue||"number"==typeof o._o.keyValue?(e.append(o._o.key,o._o.keyValue),e.append("_key",o._o.key),e.append("_action","update"),o.tran("update",o.submitted,e)):(e.append("_action","insert"),o.tran("insert",o.submitted,e))},o.submitted=function(e){if(o.parseElements(),o._o.onLoading&&o._o.onLoading(!1),200!=e.status)return o._o.submitButton&&o._o.submitButton.prop("disabled",!1),o._o.onError?o._o.onError(e,o):void(e.error&&e.error.details&&e.error.details.details&&($.growlUI(e.error.message),$('[name="'+e.error.details.details+'"]').addClass("hasError")));o._o.onSubmitted&&o._o.onSubmitted(e,o)},o.delete=function(e){return"string"==typeof e&&(o._o.keyValue=e),"string"==typeof o._o.keyValue&&o.tran("delete",o.deleted)},o.deleted=function(e){o.reset(),o._o.onLoading&&o._o.onLoading(!1),o._o.onDeleted&&o._o.onDeleted(e,o)},o.loadKey=function(e){o.reset(),o._o.keyValue=e,o.get()},o.refresh=function(){o._o.onLoading&&o._o.onLoading(!0),o.plot()},o.reload=function(){o.get()},o.reset=function(){for(o._o.keyValue=null,n=0;n<Object.keys(o._e).length;n++)k=Object.keys(o._e)[n],e=o._e[k],"checkbox"==e.type?$(e.element).prop("checked",!1):"file"==e.type&&$(e.element).attr("data-picpuload-file")?$("[data-picpuload-trash="+$(e.element).attr("data-picpuload-file")+"]").click():"file"==e.type||(e.element.value="");o.parseElements(),o._o.onReset&&o._o.onReset(o)},o.tran=function(e,t,n){let a;if(n){if(a=n,o._o.filters)for(f in o._o.filters)a.append("_filters["+f+"]",o._o.filters[f])}else a={_key:o._o.key,_action:e,[o._o.key]:o._o.keyValue,_filters:o._o.filters?o._o.filters:{}};let i=o._o.transaction;"delete"==e&&o._o.transactionDelete?i=o._o.transactionDelete:"select"==e&&o._o.transactionSelect?i=o._o.transactionSelect:"update"==e&&o._o.transactionUpdate?i=o._o.transactionUpdate:"insert"==e&&o._o.transactionInsert&&(i=o._o.transactionInsert),o._o.onLoading&&o._o.onLoading(!0),i(a,t,o._o.onDownload?o._o.onDownload:null,o._o.onUpload?o._o.onUpload:null,o._o.onLoad?o._o.onLoad:null)},o._o=t,o.parseElements(),o._o.submitButton&&o._o.submitButton.click(o.submit),o._o.data?o.set(o._o.data):o._o.keyValue&&o.get(),o};